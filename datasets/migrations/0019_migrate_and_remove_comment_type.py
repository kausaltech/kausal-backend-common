# Generated by Django 5.2.4 on 2025-10-22 09:47

from django.db import migrations


def migrate_type_to_booleans(apps, schema_editor):
    DataPointComment = apps.get_model('datasets', 'DataPointComment')

    DataPointComment.objects.filter(type='review').update(is_review=True, is_sticky=False)
    DataPointComment.objects.filter(type='sticky').update(is_sticky=True, is_review=False)
    DataPointComment.objects.filter(type='plain').update(is_sticky=False, is_review=False)


def migrate_booleans_to_type(apps, schema_editor):
    DataPointComment = apps.get_model('datasets', 'DataPointComment')

    DataPointComment.objects.filter(is_review=True, is_sticky=True).update(type='review')
    DataPointComment.objects.filter(is_review=True, is_sticky=False).update(type='review')
    DataPointComment.objects.filter(is_review=False, is_sticky=True).update(type='sticky')
    DataPointComment.objects.filter(is_review=False, is_sticky=False).update(type='plain')


class Migration(migrations.Migration):

    dependencies = [
        ('datasets', '0018_add_comment_boolean_fields'),
    ]

    operations = [
        migrations.RunPython(
            migrate_type_to_booleans,
            reverse_code=migrate_booleans_to_type,
        ),

        migrations.RemoveField(
            model_name='datapointcomment',
            name='type',
        ),
    ]
